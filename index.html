<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>115 學測倒數計時</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Weather Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@500;800&family=Noto+Sans+TC:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* 手機版尺寸 */
            --digit-height: 4.5rem; 
            --digit-width: 2.8rem;
            --font-size: 2.5rem;

            /* 動態變數 (JS 控制) */
            --bg-base: #050505; /* 網頁基底色 */
            --bg-color-1: rgba(76, 29, 149, 0.15); /* 光暈 1 */
            --bg-color-2: rgba(14, 165, 233, 0.15); /* 光暈 2 */
            --accent-color: #38bdf8; /* 數字高亮色 */
        }

        @media (min-width: 640px) {
            :root {
                --digit-height: 7rem;
                --digit-width: 4.5rem;
                --font-size: 5rem;
            }
        }

        @media (min-width: 1024px) {
            :root {
                --digit-height: 9rem;
                --digit-width: 6rem;
                --font-size: 6.5rem;
            }
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-base); /* 使用變數 */
            color: #f8fafc;
            overflow: hidden;
            transition: background-color 3s ease; /* 平滑過渡 */
        }

        /* 背景光暈 */
        .ambient-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 15% 50%, var(--bg-color-1), transparent 25%),
                radial-gradient(circle at 85% 30%, var(--bg-color-2), transparent 25%);
            z-index: -1;
            filter: blur(40px);
            animation: breathe 10s ease-in-out infinite alternate;
            transition: background 3s ease;
        }

        @keyframes breathe {
            0% { opacity: 0.5; transform: scale(1); }
            100% { opacity: 0.8; transform: scale(1.1); }
        }

        /* 玻璃擬態容器 */
        .glass-panel {
            background: rgba(20, 20, 25, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 
                0 20px 50px -12px rgba(0, 0, 0, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: box-shadow 0.5s ease, border-color 0.5s ease;
        }

        /* 滾動容器 */
        .ticker-column {
            height: var(--digit-height);
            width: var(--digit-width);
            overflow: hidden;
            position: relative;
            background: linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(30,30,35,0.9) 50%, rgba(0,0,0,0.8) 100%);
            border-radius: 0.35rem;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.8);
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* 數字條帶 */
        .ticker-strip {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            display: flex;
            flex-direction: column;
            will-change: transform;
            transform: translateY(calc(-1 * var(--digit-height)));
        }

        /* 單個數字 */
        .ticker-digit {
            height: var(--digit-height);
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'JetBrains Mono', monospace;
            font-size: var(--font-size);
            font-weight: 800;
            color: #e2e8f0;
            line-height: var(--digit-height);
            text-shadow: 0 0 15px var(--accent-color);
            background: linear-gradient(180deg, #fff 30%, #94a3b8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            flex-shrink: 0; 
            transition: text-shadow 2s ease;
        }

        /* 標籤文字 */
        .label-text {
            font-size: 0.65rem;
            color: #64748b;
            margin-top: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            text-align: center;
            font-weight: 500;
        }

        @media (min-width: 640px) {
            .label-text {
                font-size: 0.875rem;
                letter-spacing: 0.2em;
            }
        }
        
        /* 網格背景 */
        .grid-bg {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                              linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            mask-image: radial-gradient(circle at center, black 40%, transparent 80%);
            position: absolute;
            inset: 0;
            z-index: -2;
        }

        /* 語錄淡入淡出 Class */
        .fade-in {
            opacity: 1;
            transform: translateY(0);
        }
        .fade-out {
            opacity: 0;
            transform: translateY(10px);
        }
        #quote {
            transition: opacity 1s ease-in-out, transform 1s ease-in-out;
        }
        
        /* 天氣資訊淡入 */
        #weather-info {
            opacity: 0;
            transition: opacity 1s ease;
        }
        #weather-info.visible {
            opacity: 0.8;
        }
    </style>
</head>
<body class="h-screen w-screen flex flex-col items-center justify-center relative selection:bg-sky-500 selection:text-white">

    <!-- 背景元素 -->
    <div class="grid-bg"></div>
    <div class="ambient-bg" id="ambient-bg"></div>

    <main class="z-10 flex flex-col items-center justify-center w-full max-w-6xl px-2 sm:px-4">
        
        <!-- 標題區域 -->
        <header class="text-center mb-6 sm:mb-10 relative">
            <div class="absolute -inset-1 blur-xl bg-gradient-to-r from-blue-600 to-cyan-500 opacity-20 rounded-full"></div>
            <h1 class="relative text-3xl sm:text-4xl md:text-6xl font-bold tracking-wider text-transparent bg-clip-text bg-gradient-to-br from-white to-slate-400">
                115 學科能力測驗
            </h1>
        </header>

        <!-- 計時器主體 -->
        <div class="glass-panel px-4 py-8 sm:p-12 rounded-2xl sm:rounded-3xl w-full max-w-fit mx-auto transition-all duration-500 hover:shadow-[0_0_40px_-10px_rgba(56,189,248,0.2)]">
            <div class="flex flex-nowrap items-start justify-center gap-2 sm:gap-6 md:gap-8">
                
                <!-- 天 -->
                <div class="flex flex-col items-center">
                    <div class="flex gap-1 sm:gap-2" id="days-container"></div>
                    <span class="label-text">DAYS</span>
                </div>

                <div class="text-2xl sm:text-4xl md:text-6xl text-slate-700 font-mono pt-[0.8rem] sm:pt-[1.5rem] md:pt-[2rem] select-none font-thin opacity-50">:</div>

                <!-- 時 -->
                <div class="flex flex-col items-center">
                    <div class="flex gap-1 sm:gap-2" id="hours-container"></div>
                    <span class="label-text">HOURS</span>
                </div>

                <div class="text-2xl sm:text-4xl md:text-6xl text-slate-700 font-mono pt-[0.8rem] sm:pt-[1.5rem] md:pt-[2rem] select-none font-thin opacity-50">:</div>

                <!-- 分 -->
                <div class="flex flex-col items-center">
                    <div class="flex gap-1 sm:gap-2" id="minutes-container"></div>
                    <span class="label-text">MINS</span>
                </div>

                <div class="text-2xl sm:text-4xl md:text-6xl text-slate-700 font-mono pt-[0.8rem] sm:pt-[1.5rem] md:pt-[2rem] select-none font-thin opacity-50">:</div>

                <!-- 秒 -->
                <div class="flex flex-col items-center">
                    <div class="flex gap-1 sm:gap-2" id="seconds-container"></div>
                    <span class="label-text">SECS</span>
                </div>
            </div>
        </div>
        
        <!-- 底部區域：時間、天氣與語錄 -->
        <div class="mt-8 w-full flex flex-col items-center gap-3">
            
            <!-- 時間與天氣列 (並排顯示) -->
            <div class="flex items-baseline justify-center gap-3 sm:gap-5">
                <!-- 時間 -->
                <div class="text-slate-400 font-mono tracking-widest text-xl sm:text-3xl font-bold opacity-90">
                    <span id="current-time"></span>
                </div>
                
                <!-- 極簡天氣資訊 -->
                <div id="weather-info" class="flex items-center gap-2 text-slate-500 text-sm sm:text-base font-medium">
                    <i id="weather-icon" class="fas fa-moon"></i>
                    <span id="weather-temp">--°</span>
                </div>
            </div>

            <!-- 語錄 (稍微上移) -->
            <div class="h-14 flex items-center justify-center px-4 w-full">
                <p id="quote" class="text-slate-500/80 italic text-base sm:text-xl md:text-2xl font-light tracking-wide fade-out max-w-4xl leading-relaxed text-center">
                    <!-- JS 寫入 -->
                </p>
            </div>
        </div>
    </main>

    <script>
        // 倒數時間目標
        const TARGET_DATE = new Date('2026-01-17T09:15:00'); 
        
        let currentDigitValues = {};

        function initTicker(elementId, digits) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            for (let i = 0; i < digits; i++) {
                const column = document.createElement('div');
                column.className = 'ticker-column';
                column.id = `${elementId}-${i}`; 
                
                const strip = document.createElement('div');
                strip.className = 'ticker-strip';
                
                strip.innerHTML = `
                    <div class="ticker-digit">0</div>
                    <div class="ticker-digit">0</div>
                `;
                
                currentDigitValues[column.id] = 0; 
                column.appendChild(strip);
                container.appendChild(column);
            }
        }

        initTicker('days-container', 2);
        initTicker('hours-container', 2);
        initTicker('minutes-container', 2);
        initTicker('seconds-container', 2);

        function updateStrip(containerId, value, padLength) {
            let safeValue = value;
            const maxVal = Math.pow(10, padLength) - 1;
            if (safeValue > maxVal) safeValue = maxVal;

            const strValue = safeValue.toString().padStart(padLength, '0');
            
            for (let i = 0; i < padLength; i++) {
                const colId = `${containerId}-${i}`;
                const column = document.getElementById(colId);
                const strip = column.querySelector('.ticker-strip');
                const digits = strip.querySelectorAll('.ticker-digit');
                
                const nextDigit = strValue[i];
                const prevDigit = currentDigitValues[colId];

                if (parseInt(nextDigit) === prevDigit) {
                    if (digits[1].innerText !== nextDigit) {
                         digits[1].innerText = nextDigit;
                         currentDigitValues[colId] = parseInt(nextDigit);
                    }
                    continue;
                }

                currentDigitValues[colId] = parseInt(nextDigit);

                digits[0].innerText = nextDigit;
                digits[1].innerText = prevDigit; 

                strip.style.transition = 'none';
                strip.style.transform = 'translateY(calc(-1 * var(--digit-height)))';
                void strip.offsetWidth;

                strip.style.transition = 'transform 0.6s cubic-bezier(0.25, 1, 0.5, 1)';
                strip.style.transform = 'translateY(0)';

                setTimeout(() => {
                    strip.style.transition = 'none';
                    digits[1].innerText = nextDigit; 
                    strip.style.transform = 'translateY(calc(-1 * var(--digit-height)))'; 
                }, 600);
            }
        }

        function updateCurrentTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const date = now.getDate().toString().padStart(2, '0');
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            
            const timeString = `${year}/${month}/${date} ${hours}:${minutes}`;
            document.getElementById('current-time').innerText = timeString;
        }

        function updateTimer() {
            const now = new Date();
            const diff = TARGET_DATE - now;

            updateCurrentTime();

            if (diff <= 0) {
                document.querySelector('h1').innerText = "考試開始";
                return;
            }

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            updateStrip('days-container', days, 2);
            updateStrip('hours-container', hours, 2);
            updateStrip('minutes-container', minutes, 2);
            updateStrip('seconds-container', seconds, 2);
        }
        
        function initialRender() {
            const now = new Date();
            const diff = TARGET_DATE - now;
            updateCurrentTime();

            if (diff <= 0) return;

            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            const setInitial = (id, val, len) => {
                const str = val.toString().padStart(len, '0');
                for(let i=0; i<len; i++) {
                    const colId = `${id}-${i}`;
                    const digit = parseInt(str[i]);
                    currentDigitValues[colId] = digit;
                    const strip = document.getElementById(colId).querySelector('.ticker-strip');
                    strip.querySelectorAll('.ticker-digit')[1].innerText = digit; 
                }
            };

            setInitial('days-container', days, 2);
            setInitial('hours-container', hours, 2);
            setInitial('minutes-container', minutes, 2);
            setInitial('seconds-container', seconds, 2);
        }

        initialRender();
        setInterval(updateTimer, 1000);

        // --- 語錄系統邏輯 ---
        
        const rawQuotes = [
            "堅持到底，未來的你會感謝現在拼命的自己。", "每多讀一分，就離夢想更近一步。", "乾坤未定，你我皆是黑馬。", "耐得住寂寞，才守得住繁華。",
            "將來的你，一定會感謝現在奮鬥的自己。", "星光不問趕路人，時光不負有心人。", "現在的努力，是為了兌換未來的自由。", "這一秒不放棄，下一秒就有希望。",
            "讀書不是為了雄辯和駁斥，而是為了衡量和考慮。", "你的負擔將變成禮物，你受的苦將照亮你的路。", "沒有奇蹟，只有累積。", "既然選擇了遠方，便只顧風雨兼程。",
            "只要路是對的，就不怕路遠。", "當你想要放棄的時候，想想當初為什麼開始。", "比你優秀的人都在努力，你憑什麼不努力。", "不為模糊不清的未來擔憂，只為清清楚楚的現在努力。",
            "可以哭，可以累，但不可以放棄。", "真正能讓你倒下的，不是對手，而是你絕望的內心。", "努力不一定會成功，但不努力一定很輕鬆，只是會後悔。", "別在最能吃苦的年紀選擇安逸。",
            "成功的路上並不擁擠，因為堅持的人不多。", "今天不想跑，所以才去跑，這才是長距離跑者的思維。", "天賦決定上限，努力決定下限。", "不要假裝努力，結果不會陪你演戲。",
            "若不趁年輕努力，難道要等到年老時再來後悔嗎？", "用實力讓情懷落地，用分數讓夢想成真。", "任何值得去的地方，都沒有捷徑。", "你必須非常努力，才能看起來毫不費力。",
            "最暗的夜，才能看見最美的星光。", "現在流的汗水，是為了不讓未來流淚。", "夢想註定是孤獨的旅行，路上少不了質疑和嘲笑。", "寧願辛苦一陣子，不要辛苦一輩子。",
            "不要讓未來的你，討厭現在的自己。", "學習是唯一的捷徑，堅持是唯一的出路。", "生活不會虧待每一個努力向上的人。"
        ];

        let quotesQueue = [];
        const quoteElement = document.getElementById('quote');

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function getNextQuote() {
            if (quotesQueue.length === 0) {
                quotesQueue = shuffleArray([...rawQuotes]);
            }
            return quotesQueue.pop();
        }

        function updateQuote() {
            quoteElement.classList.remove('fade-in');
            quoteElement.classList.add('fade-out');
            setTimeout(() => {
                quoteElement.innerText = getNextQuote();
                quoteElement.classList.remove('fade-out');
                quoteElement.classList.add('fade-in');
                scheduleNextQuote();
            }, 1000);
        }

        function scheduleNextQuote() {
            const minTime = 30 * 60 * 1000;
            const maxTime = 50 * 60 * 1000;
            const randomTime = Math.floor(Math.random() * (maxTime - minTime + 1) + minTime);
            console.log(`Next quote update in ${randomTime / 1000 / 60} minutes.`);
            setTimeout(updateQuote, randomTime);
        }

        quotesQueue = shuffleArray([...rawQuotes]);
        quoteElement.innerText = getNextQuote();
        quoteElement.classList.remove('fade-out');
        quoteElement.classList.add('fade-in');
        scheduleNextQuote();


        // --- 天氣與背景切換邏輯 ---

        const root = document.documentElement;
        const weatherInfo = document.getElementById('weather-info');
        const weatherIcon = document.getElementById('weather-icon');
        const weatherTemp = document.getElementById('weather-temp');

        // 主題定義 (包含底色 base)
        const themes = {
            night: {
                // 原本的夜間模式
                base: '#050505', 
                c1: 'rgba(76, 29, 149, 0.15)',
                c2: 'rgba(14, 165, 233, 0.15)',
                accent: 'rgba(56, 189, 248, 0.3)', 
                icon: 'fa-moon'
            },
            morning: {
                // 早晨 (Fresh / Cool): 極深青綠色 (Teal 950)
                // 光暈: 柔和的日出粉 + 淡青
                base: '#042f2e', 
                c1: 'rgba(251, 207, 232, 0.15)', // Light Pink
                c2: 'rgba(20, 184, 166, 0.15)', // Teal
                accent: 'rgba(253, 186, 116, 0.4)', // Soft Orange
                icon: 'fa-sun'
            },
            noon: {
                // 中午 (Bright / Contrast): 深邃蔚藍色 (Sky 950)
                // 光暈: 透亮白 + 強烈金黃
                base: '#082f49', 
                c1: 'rgba(255, 255, 255, 0.1)', // White glow
                c2: 'rgba(234, 179, 8, 0.2)',  // Gold
                accent: 'rgba(250, 204, 21, 0.5)', // Yellow
                icon: 'fa-sun'
            },
            clear_day: {
                // 一般晴天/下午: 深天藍
                base: '#082f49', 
                c1: 'rgba(14, 165, 233, 0.2)', 
                c2: 'rgba(234, 179, 8, 0.15)',  
                accent: 'rgba(250, 204, 21, 0.4)', 
                icon: 'fa-sun'
            },
            cloudy: {
                // 陰天
                base: '#0f172a', 
                c1: 'rgba(71, 85, 105, 0.2)',  
                c2: 'rgba(148, 163, 184, 0.15)', 
                accent: 'rgba(203, 213, 225, 0.3)', 
                icon: 'fa-cloud'
            },
            rain: {
                // 雨天
                base: '#020617', 
                c1: 'rgba(30, 41, 59, 0.25)',  
                c2: 'rgba(59, 130, 246, 0.15)', 
                accent: 'rgba(96, 165, 250, 0.3)', 
                icon: 'fa-cloud-rain'
            },
            dusk: {
                // 黃昏
                base: '#2e1065', 
                c1: 'rgba(124, 58, 237, 0.2)', 
                c2: 'rgba(234, 88, 12, 0.15)', 
                accent: 'rgba(244, 114, 182, 0.4)', 
                icon: 'fa-cloud-sun'
            }
        };

        function applyTheme(themeName, temp = null) {
            const theme = themes[themeName];
            if (!theme) return;

            // 更新所有 CSS 變數
            root.style.setProperty('--bg-base', theme.base);
            root.style.setProperty('--bg-color-1', theme.c1);
            root.style.setProperty('--bg-color-2', theme.c2);
            root.style.setProperty('--accent-color', theme.accent); 

            weatherIcon.className = `fas ${theme.icon}`;
            
            if (temp !== null) {
                weatherTemp.innerText = `${Math.round(temp)}°C`;
            } else {
                weatherTemp.innerText = '--°';
            }

            weatherInfo.classList.add('visible');
        }

        // 根據時間判定 (無天氣資料時的後備方案)
        function getTimeBasedTheme() {
            const hour = new Date().getHours();
            if (hour >= 5 && hour < 9) return 'morning'; // 5-9 早晨
            if (hour >= 9 && hour < 11) return 'clear_day';
            if (hour >= 11 && hour < 14) return 'noon'; // 11-14 中午
            if (hour >= 14 && hour < 17) return 'clear_day';
            if (hour >= 17 && hour < 19) return 'dusk'; 
            return 'night';
        }

        async function fetchWeather(lat, lon) {
            try {
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code,is_day&timezone=auto`;
                const response = await fetch(url);
                const data = await response.json();
                const current = data.current;
                
                const code = current.weather_code;
                const isDay = current.is_day === 1;
                const temp = current.temperature_2m;

                let theme = 'night';

                if (!isDay) {
                    theme = 'night';
                } else {
                    // 白天邏輯：先看天氣，若是好天氣則細分時間
                    const isClear = (code === 0 || code === 1);
                    const hour = new Date().getHours();

                    if (isClear) {
                        if (hour >= 5 && hour < 9) theme = 'morning';
                        else if (hour >= 11 && hour < 14) theme = 'noon';
                        else if (hour >= 16 && hour < 19) theme = 'dusk';
                        else theme = 'clear_day';
                    } else {
                        // 天氣不好時優先顯示天氣狀況 (除非是極端的黃昏)
                        if (code === 2 || code === 3 || code === 45 || code === 48) theme = 'cloudy';
                        else if (code >= 51) theme = 'rain';
                        
                        // 即使是雨天，黃昏時分也可以帶點紫色氛圍，這裡選擇簡單處理
                        if (hour >= 17 && hour < 19 && theme === 'cloudy') theme = 'dusk';
                    }
                }

                applyTheme(theme, temp);

            } catch (error) {
                console.error("Weather fetch failed:", error);
                applyTheme(getTimeBasedTheme());
            }
        }

        function initWeather() {
            // 預設
            applyTheme(getTimeBasedTheme());

            // 固定使用高雄市楠梓區的座標
            const lat = 22.728;
            const lon = 120.327;
            
            fetchWeather(lat, lon);
        }

        initWeather();
        setInterval(initWeather, 30 * 60 * 1000);

    </script>
</body>
</html>
